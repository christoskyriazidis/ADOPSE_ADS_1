<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/styles/style.css">
    <link rel="stylesheet" href="/styles/search/search.css">
    <link rel="stylesheet" href="/styles/components/adContainer/adContainer.css">


    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/oidc-client/1.11.5/oidc-client.min.js"></script>
    <script src="/scripts/components/navbarComponent.js" defer></script>
    <script src="/scripts/sign-in.js" defer></script>
    <script src="/scripts/components/wishlistComponent.js" defer></script>
    <script src="/scripts/components/paginationComponent.js" defer></script>
    <script src="/scripts/components/adContainerComponent.js" defer></script>
    <script src="/scripts/dictionary.js"></script>
    <script src="/scripts/filters.js"></script>
    <script src="/scripts/components/notificationComponent.js" defer></script>
</head>

<body>
    <navbar-component></navbar-component>
    <main>
        <div class="optionsContainer">

            <div class="title info">
                <h2>Filters</h2>
            </div>
            <div class="info">
                <h4>Categories</h4>
            </div>

            <div class="categoryGroup group"></div>
            <div class="info">
                <h4>Ad types</h4>
            </div>
            <div class="typeGroup group"></div>
            <div class="info">
                <h4>Condition</h4>
            </div>
            <div class="conditionGroup group"></div>
            <div class="info">
                <h4>State</h4>
            </div>
            <div class="stateGroup group"></div>
            <div class="info">
                <h4>Manufacturers</h4>
            </div>
            <div class="manufacturerGroup group"></div>
            <button class="submitSearch">submit search</button>
        </div>
        <div class="mainContentArea">
            <div class="paginationArea">
                <pagination-component current-page="1" last-page="8"></pagination-component>
            </div>
            <div class="contentContainer"></div>
            <div class="paginationArea">
                <pagination-component current-page="1" last-page="8" ></pagination-component>
            </div>
        </div>
    </main>

</body>
<script>
    const resourceServer="https://localhost:44374";
    const fillCategories = (value, id) => {
        const categories = document.querySelector(".categoryGroup")
        categories.innerHTML += `<input type="radio" name="category"   id="cat${id}">
                                 <label for="cat${id}">${value}</label><br>`
    }
    const fillType = (value, id) => {
        const types = document.querySelector(".typeGroup")
        types.innerHTML += `<input type="checkbox" name="type" id="typ${id}">
                            <label for="typ${id}">${value}</label><br>`
    }

    const fillManufacturer = (value, id) => {
        const manufacturers = document.querySelector(".manufacturerGroup")
        manufacturers.innerHTML += `<input type="checkbox" name="manufacturer" id="man${id}">
                                     <label for="man${id}">${value}</label><br>`
    }
    const fillCondition = (value, id) => {

        const conditions = document.querySelector(".conditionGroup")
        conditions.innerHTML += `<input type="checkbox" name="condition" id="con${id}">
                                  <label for="con${id}">${value}</label><br>`
    }
    const fillState = (value, id) => {
        console.log(value);
        const states = document.querySelector(".stateGroup")
        states.innerHTML += `<input type="checkbox" name="state" id="sta${id}">
                             <label for="sta${id}">${value}</label><br>`
    }
    let currentPage;
    let dictMaps;
    let dict = new Dictionary();
    dict.init().then(maps => {
        maps.cat.forEach(fillCategories)
        maps.sta.forEach(fillState)
        maps.man.forEach(fillManufacturer)
        maps.typ.forEach(fillType)
        maps.con.forEach(fillCondition)
        dictMaps = maps
    }).then(() => {
        callPage(`${resourceServer}/ad?PageNumber=1&PageSize=5`)
        saveLast(`?PageNumber=1&PageSize=5`)
    })


    const populateContentArea = (data) => {

        document.querySelector(".contentContainer").innerHTML = '';
        let allAds = ""
        for (object of data.ads) {
            allAds += `<ad-component title="${object.title}" condition="${dictMaps.con.get(object.condition)}" price="${object.price}" item-image="${object.img}" id="${object.id}"></ad-component>`
        }
        document.querySelector(".contentContainer").innerHTML += allAds;
        const pagers = document.querySelectorAll('pagination-component')

        for (prop in data) {

            for (pager of pagers) {

                pager.setAttribute("current-page", data['currentPage'])
                pager.setAttribute("next-page", data['nextPageUrl'])
                pager.setAttribute("previous-page", data['previousPageUrl'])
                pager.setAttribute('last-page-url', data['lastPageUrl'])
                pager.setAttribute("last-page", data['totalPages'])
            }

        }


    }
    let lastCall;
    const callPage = (page) => axios.get(page).then((response) => response.data).then((data) => {
        populateContentArea(data)
        currentPage = data.currentPage;
    })
    const saveLast=(currentUrl)=>{
        lastCall=currentUrl;
        for (pager of document.querySelectorAll("pagination-component")) {
        pager.setAttribute("current-url", `${resourceServer}/${finalQuery!=null?`filter/${finalQuery}`:`ad`}${currentUrl}`)
        
    }
    }
    const searchbtn = document.querySelector(".submitSearch")
    searchbtn.addEventListener("click", createQueryString)
    //callPage("https://localhost:44374/ad?PageNumber=1&PageSize=10")

</script>

<script>


</script>



</html>